Adapted from https://github.com/Freeverc/image-processing
